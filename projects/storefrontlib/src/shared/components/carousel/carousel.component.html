<ng-container *ngIf="items?.length > 0 && (size$ | async) as size">
  <h3 *ngIf="title">{{ title }}</h3>
  <div
    #carousel
    class="carousel-panel"
    [ngClass]="'size-' + size"
    [cxFocus]="focusConfig"
  >
    <button
      class="previous"
      (click)="previous()"
      [style.visibility]="(previous$ | async)?.visible ? 'visible' : 'hidden'"
      [disabled]="!(previous$ | async)?.enabled"
    >
      <cx-icon [type]="previousIcon"></cx-icon>
    </button>

    <div class="slides" #slides>
      <!-- 
        we still keep the notion of slide elements, although we don't use this anymore. Most likely we deprecate this in 4.0. In 3.0, we start introducing virtual slides. 
      -->
      <ng-container *ngFor="let _ of items; let i = index">
        <div
          class="slide"
          *ngIf="i % size === 0"
          [class.active]="i === activeSlide"
        >
          <!-- 
            We render the carousel item, so that we have an element to work with. This allows to do skeleton, prefetching and accessibility.

            Deprecate:
            - active class

            new with 3.0
            - prefetching
            - intersection
          -->
          <div
            *ngFor="let data of items | slice: i:i + size; let itemNum = index"
            class="item"
            [class.active]="i === activeSlide"
            (mouseenter)="prefetch = itemNum"
            cxIntersected
            #templateRef
            #item="cxIntersected"
            (intersect)="intersect($event, templateRef)"
          >
            <ng-container
              *ngTemplateOutlet="
                template;
                context: {
                  item: data,
                  prefetch: prefetch > itemNum || (item.intersect | async),
                  tab: tabIndex(templateRef) | async
                }
              "
            ></ng-container>
          </div>
        </div>
      </ng-container>
    </div>

    <button
      class="next"
      (focus)="bumpPrefetch()"
      (click)="next($event)"
      [style.visibility]="(next$ | async)?.visible ? 'visible' : 'hidden'"
      [disabled]="!(next$ | async)?.enabled"
    >
      <cx-icon [type]="nextIcon"></cx-icon>
    </button>
  </div>

  <div class="indicators">
    <button
      *ngFor="let indicator of indicators$ | async; let i = index"
      (click)="scroll(indicator.position)"
      [class.selected]="indicator.selected"
      [disabled]="indicator.selected"
      [cxFocus]="{ key: i + 1, group: focusConfig.group }"
      tabindex="-1"
      (mouseenter)="prefetch = i * this._prefetchNum"
    >
      <cx-icon [type]="indicatorIcon"></cx-icon>
    </button>
  </div>
</ng-container>
