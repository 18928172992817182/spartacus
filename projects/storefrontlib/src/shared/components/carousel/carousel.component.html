<ng-container *ngIf="items?.length > 0 && (size$ | async) as size">
  <h3 *ngIf="title">{{ title }}</h3>

  <div
    class="carousel-panel"
    [ngClass]="'size-' + size"
    [cxFocus]="focusConfig"
    #carousel
  >
    <button
      class="previous"
      (click)="previous()"
      [style.visibility]="(previous$ | async)?.visible ? 'visible' : 'hidden'"
      [disabled]="!(previous$ | async)?.enabled"
      [cxFocus]="{ key: 'previous', group: focusConfig.group }"
      tabindex="-1"
    >
      <cx-icon [type]="previousIcon"></cx-icon>
    </button>

    <div class="slides">
      <ng-container *ngFor="let _ of items; let i = index">
        <div
          class="slide"
          *ngIf="i % size === 0"
          [class.active]="i === activeSlide"
        >
          <ng-container
            *ngFor="let item of items | slice: i:i + size; let j = index"
          >
            <div
              #item
              *ngIf="item | async as data"
              class="item"
              [class.active]="i === activeSlide"
              cxIntersected
              (intersect)="intersect($event, item)"
            >
              <ng-container
                *ngTemplateOutlet="template; context: { item: data }"
              ></ng-container>
            </div>
          </ng-container>
        </div>
      </ng-container>
    </div>

    <button
      class="next"
      (click)="next()"
      [style.visibility]="(next$ | async)?.visible ? 'visible' : 'hidden'"
      [disabled]="!(next$ | async)?.enabled"
      [cxFocus]="{ key: 'next', group: focusConfig.group }"
      tabindex="-1"
    >
      <cx-icon [type]="nextIcon"></cx-icon>
    </button>
  </div>

  <div class="indicators">
    <button
      *ngFor="let indicator of indicators$ | async; let i = index"
      (click)="scroll(indicator.index)"
      [class.selected]="indicator.selected"
      [cxFocus]="{ key: i + 1, group: focusConfig.group }"
      tabindex="-1"
    >
      <cx-icon [type]="indicatorIcon"></cx-icon>
    </button>
  </div>
</ng-container>
